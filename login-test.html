<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 시스템 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .test-btn.danger {
            background: #dc3545;
        }
        .test-btn.success {
            background: #28a745;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        #logs {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .info-card {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #2196f3;
        }
        .info-card h4 {
            margin-top: 0;
            color: #1976d2;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 LMS 로그인 시스템 테스트</h1>
        <p>데스크탑과 노트북 간 로그인 문제를 진단하고 테스트합니다.</p>

        <!-- 시스템 상태 -->
        <div class="test-section">
            <h3>📊 시스템 상태</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>환경 정보</h4>
                    <div id="env-info"></div>
                </div>
                <div class="info-card">
                    <h4>Firebase 상태</h4>
                    <div id="firebase-status"></div>
                </div>
                <div class="info-card">
                    <h4>로컬 데이터</h4>
                    <div id="local-data-status"></div>
                </div>
            </div>
        </div>

        <!-- 로그인 테스트 -->
        <div class="test-section">
            <h3>🧪 로그인 테스트</h3>
            <form id="test-login-form">
                <div class="form-group">
                    <label for="test-email">테스트 이메일:</label>
                    <input type="email" id="test-email" value="test@example.com" required>
                </div>
                <div class="form-group">
                    <label for="test-password">테스트 비밀번호:</label>
                    <input type="password" id="test-password" value="test123" required>
                </div>
                <button type="submit" class="test-btn">로그인 테스트 실행</button>
                <button type="button" class="test-btn success" onclick="createTestUser()">테스트 계정 생성</button>
                <button type="button" class="test-btn danger" onclick="clearAllData()">모든 데이터 초기화</button>
            </form>
        </div>

        <!-- 기타 테스트 -->
        <div class="test-section">
            <h3>🛠️ 추가 테스트</h3>
            <button class="test-btn" onclick="testFirebaseConnection()">Firebase 연결 테스트</button>
            <button class="test-btn" onclick="testLocalStorage()">LocalStorage 테스트</button>
            <button class="test-btn" onclick="showAllUsers()">등록된 사용자 확인</button>
            <button class="test-btn" onclick="syncData()">데이터 동기화</button>
            <button class="test-btn" onclick="clearLogs()">로그 지우기</button>
        </div>

        <!-- 회원가입 동기화 테스트 -->
        <div class="test-section">
            <h3>🔄 회원가입 동기화 테스트</h3>
            <button class="test-btn success" onclick="testRegistrationSync()">회원가입 동기화 테스트</button>
            <button class="test-btn" onclick="compareFirebaseAndLocal()">Firebase vs LocalStorage 비교</button>
            <button class="test-btn success" onclick="testCompleteRegisterLoginFlow()">회원가입→로그인 전체 테스트</button>
        </div>

        <div id="logs"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <!-- Firebase 설정 -->
    <script src="firebase-config.js"></script>
    <!-- <script src="firebase-config.local.js" onerror="console.log('로컬 Firebase 설정 파일이 없습니다.')"></script> -->

    <!-- 임시 설정 (파일 로딩 실패 시 대안) -->
    <script>
        if (typeof firebaseConfigLocal === 'undefined') {
            const firebaseConfigLocal = {
                apiKey: "AIzaSyAW1hX726N0EQv6uW0_6yUyGCsWylYlEEI",
                authDomain: "lms-26168.firebaseapp.com",
                databaseURL: "https://lms-26168-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "lms-26168",
                storageBucket: "lms-26168.firebasestorage.app",
                messagingSenderId: "264403082469",
                appId: "1:264403082469:web:74f35eaec8e2c2f322080c",
                measurementId: "G-9XGFHD0R9P"
            };

            if (typeof firebaseConfig !== 'undefined') {
                Object.assign(firebaseConfig, firebaseConfigLocal);
            }
        }
    </script>

    <script src="firebase-service.js"></script>

    <script>
        const logs = document.getElementById('logs');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : type === 'warning' ? '⚠️' : 'ℹ️';
            logs.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            logs.textContent = '';
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            log('로그인 테스트 시스템 시작');
            await updateSystemStatus();

            // 테스트 폼 이벤트
            document.getElementById('test-login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await testLogin();
            });
        });

        async function updateSystemStatus() {
            // 환경 정보
            const envInfo = document.getElementById('env-info');
            envInfo.innerHTML = `
                <div><span class="status-indicator status-ok"></span>브라우저: ${navigator.userAgent.split(' ')[0]}</div>
                <div><span class="status-indicator status-ok"></span>플랫폼: ${navigator.platform}</div>
                <div><span class="status-indicator ${navigator.onLine ? 'status-ok' : 'status-error'}"></span>온라인: ${navigator.onLine ? '연결됨' : '오프라인'}</div>
                <div><span class="status-indicator ${navigator.cookieEnabled ? 'status-ok' : 'status-error'}"></span>쿠키: ${navigator.cookieEnabled ? '활성화' : '비활성화'}</div>
            `;

            // Firebase 상태
            const firebaseStatus = document.getElementById('firebase-status');
            const isFirebaseReady = typeof firebaseService !== 'undefined' && firebaseService.isFirebaseReady;
            firebaseStatus.innerHTML = `
                <div><span class="status-indicator ${typeof firebase !== 'undefined' ? 'status-ok' : 'status-error'}"></span>SDK: ${typeof firebase !== 'undefined' ? '로드됨' : '로드 안됨'}</div>
                <div><span class="status-indicator ${isFirebaseReady ? 'status-ok' : 'status-error'}"></span>서비스: ${isFirebaseReady ? '준비됨' : '준비 안됨'}</div>
                <div><span class="status-indicator ${typeof firebaseConfig !== 'undefined' ? 'status-ok' : 'status-error'}"></span>설정: ${typeof firebaseConfig !== 'undefined' ? '로드됨' : '로드 안됨'}</div>
            `;

            // 로컬 데이터 상태
            const localDataStatus = document.getElementById('local-data-status');
            const users = JSON.parse(localStorage.getItem('lms_users') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('lms_current_user') || 'null');
            const storageAvailable = (() => {
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    return true;
                } catch(e) {
                    return false;
                }
            })();

            localDataStatus.innerHTML = `
                <div><span class="status-indicator ${storageAvailable ? 'status-ok' : 'status-error'}"></span>LocalStorage: ${storageAvailable ? '사용 가능' : '사용 불가'}</div>
                <div><span class="status-indicator ${users.length > 0 ? 'status-ok' : 'status-warning'}"></span>등록 사용자: ${users.length}명</div>
                <div><span class="status-indicator ${currentUser ? 'status-ok' : 'status-warning'}"></span>현재 사용자: ${currentUser ? currentUser.email : '없음'}</div>
            `;

            log(`시스템 상태 업데이트 완료: Firebase=${isFirebaseReady}, Users=${users.length}`);
        }

        async function testLogin() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;

            log(`로그인 테스트 시작: ${email}`);

            try {
                // LMS 클래스 인스턴스 생성 (임시)
                const mockLMS = {
                    users: JSON.parse(localStorage.getItem('lms_users') || '[]'),
                    isFirebaseReady: typeof firebaseService !== 'undefined' && firebaseService.isFirebaseReady,

                    async login(email, password) {
                        log(`로그인 시도: Firebase Ready = ${this.isFirebaseReady}`);

                        // Firebase 시도
                        if (this.isFirebaseReady) {
                            try {
                                const result = await firebaseService.signIn(email, password);
                                if (result.success) {
                                    log('✅ Firebase 로그인 성공', 'success');
                                    return { success: true, method: 'Firebase', user: result.user };
                                } else {
                                    log(`❌ Firebase 로그인 실패: ${result.error}`, 'error');
                                }
                            } catch (e) {
                                log(`Firebase 오류: ${e.message}`, 'error');
                            }
                        }

                        // LocalStorage 시도
                        const localUser = this.users.find(u => u.email === email && u.password === password);
                        if (localUser) {
                            log('✅ LocalStorage 로그인 성공', 'success');
                            return { success: true, method: 'localStorage', user: localUser };
                        }

                        log('❌ 모든 로그인 방법 실패', 'error');
                        return { success: false };
                    }
                };

                const result = await mockLMS.login(email, password);

                if (result.success) {
                    log(`🎉 로그인 성공! 방법: ${result.method}`, 'success');
                    localStorage.setItem('lms_current_user', JSON.stringify(result.user));
                    updateSystemStatus();
                } else {
                    log('❌ 로그인 실패', 'error');
                }

            } catch (error) {
                log(`로그인 테스트 오류: ${error.message}`, 'error');
            }
        }

        function createTestUser() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;

            const users = JSON.parse(localStorage.getItem('lms_users') || '[]');

            if (!users.find(u => u.email === email)) {
                const testUser = {
                    id: Date.now(),
                    name: 'Test User',
                    email: email,
                    password: password,
                    phone: '010-1234-5678',
                    createdAt: new Date().toISOString()
                };

                users.push(testUser);
                localStorage.setItem('lms_users', JSON.stringify(users));
                log(`✅ 테스트 계정 생성됨: ${email}`, 'success');
                updateSystemStatus();
            } else {
                log(`⚠️ 이미 존재하는 계정: ${email}`, 'warning');
            }
        }

        function clearAllData() {
            if (confirm('모든 로컬 데이터를 삭제하시겠습니까?')) {
                localStorage.removeItem('lms_users');
                localStorage.removeItem('lms_current_user');
                localStorage.removeItem('lms_courses');
                localStorage.removeItem('lms_enrollments');
                log('🗑️ 모든 로컬 데이터 삭제됨', 'warning');
                updateSystemStatus();
            }
        }

        async function testFirebaseConnection() {
            if (typeof firebaseService === 'undefined') {
                log('❌ firebaseService가 로드되지 않음', 'error');
                return;
            }

            try {
                const isReady = await firebaseService.waitForFirebase();
                log(`Firebase 연결 테스트: ${isReady ? '성공' : '실패'}`, isReady ? 'success' : 'error');
            } catch (e) {
                log(`Firebase 연결 오류: ${e.message}`, 'error');
            }
        }

        function testLocalStorage() {
            try {
                const testKey = 'storage-test-' + Date.now();
                localStorage.setItem(testKey, 'test-value');
                const value = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);

                log('✅ LocalStorage 읽기/쓰기 테스트 성공', 'success');
            } catch (e) {
                log(`❌ LocalStorage 테스트 실패: ${e.message}`, 'error');
            }
        }

        function showAllUsers() {
            const users = JSON.parse(localStorage.getItem('lms_users') || '[]');
            log(`등록된 사용자 목록 (${users.length}명):`);
            users.forEach((user, index) => {
                log(`${index + 1}. ${user.email} (이름: ${user.name})`);
            });
        }

        async function syncData() {
            log('데이터 동기화 시작...');
            if (typeof firebaseService !== 'undefined' && firebaseService.isFirebaseReady) {
                try {
                    const firebaseUsers = await firebaseService.getUsers();
                    const localUsers = JSON.parse(localStorage.getItem('lms_users') || '[]');

                    log(`Firebase 사용자: ${firebaseUsers.length}명`);
                    log(`LocalStorage 사용자: ${localUsers.length}명`);

                    // Firebase 데이터로 localStorage 업데이트
                    localStorage.setItem('lms_users', JSON.stringify(firebaseUsers));

                    log('✅ Firebase → LocalStorage 동기화 완료', 'success');
                    log(`동기화된 사용자 수: ${firebaseUsers.length}명`);
                    updateSystemStatus();
                } catch (e) {
                    log(`동기화 오류: ${e.message}`, 'error');
                }
            } else {
                log('❌ Firebase가 준비되지 않아 동기화 불가', 'error');
            }
        }

        async function testRegistrationSync() {
            log('🧪 회원가입 동기화 테스트 시작...');

            if (typeof firebaseService === 'undefined' || !firebaseService.isFirebaseReady) {
                log('❌ Firebase가 준비되지 않음. 테스트 불가', 'error');
                return;
            }

            try {
                const testEmail = `test-sync-${Date.now()}@example.com`;
                const testUser = {
                    name: '동기화 테스트',
                    email: testEmail,
                    password: 'test123',
                    phone: '010-1234-5678'
                };

                log(`테스트 사용자 생성: ${testEmail}`);

                // Firebase에 사용자 등록
                const result = await firebaseService.signUp(testUser.email, testUser.password, testUser);

                if (result.success) {
                    log('✅ Firebase 회원가입 성공', 'success');

                    // Firebase에서 사용자 목록 조회
                    const firebaseUsers = await firebaseService.getUsers();
                    const newUser = firebaseUsers.find(u => u.email === testEmail);

                    if (newUser) {
                        log('✅ Firebase에서 사용자 확인됨', 'success');

                        // LocalStorage에 동기화
                        const localUsers = JSON.parse(localStorage.getItem('lms_users') || '[]');
                        const existsInLocal = localUsers.find(u => u.email === testEmail);

                        if (!existsInLocal) {
                            localUsers.push(newUser);
                            localStorage.setItem('lms_users', JSON.stringify(localUsers));
                            log('✅ LocalStorage에 동기화 완료', 'success');
                        } else {
                            log('ℹ️ 이미 LocalStorage에 존재함', 'info');
                        }

                        log('🎉 회원가입 동기화 테스트 성공!', 'success');
                        updateSystemStatus();

                    } else {
                        log('❌ Firebase에서 사용자를 찾을 수 없음', 'error');
                    }
                } else {
                    log(`❌ Firebase 회원가입 실패: ${result.error}`, 'error');
                }

            } catch (error) {
                log(`회원가입 동기화 테스트 오류: ${error.message}`, 'error');
            }
        }

        async function compareFirebaseAndLocal() {
            log('🔍 Firebase vs LocalStorage 사용자 비교...');

            try {
                if (typeof firebaseService !== 'undefined' && firebaseService.isFirebaseReady) {
                    const firebaseUsers = await firebaseService.getUsers();
                    const localUsers = JSON.parse(localStorage.getItem('lms_users') || '[]');

                    log(`Firebase 사용자 수: ${firebaseUsers.length}`);
                    log(`LocalStorage 사용자 수: ${localUsers.length}`);

                    // Firebase 사용자 목록
                    log('Firebase 사용자 목록:');
                    firebaseUsers.forEach((user, index) => {
                        log(`  ${index + 1}. ${user.email} (${user.name}) [${user.authMethod || 'firebase'}]`);
                    });

                    // LocalStorage 사용자 목록
                    log('LocalStorage 사용자 목록:');
                    localUsers.forEach((user, index) => {
                        log(`  ${index + 1}. ${user.email} (${user.name}) [${user.authMethod || 'unknown'}]`);
                    });

                    // 차이점 분석
                    const firebaseEmails = firebaseUsers.map(u => u.email);
                    const localEmails = localUsers.map(u => u.email);

                    const onlyInFirebase = firebaseEmails.filter(email => !localEmails.includes(email));
                    const onlyInLocal = localEmails.filter(email => !firebaseEmails.includes(email));

                    if (onlyInFirebase.length > 0) {
                        log(`🔥 Firebase에만 있는 사용자 (${onlyInFirebase.length}명):`, 'warning');
                        onlyInFirebase.forEach(email => log(`  - ${email}`));
                    }

                    if (onlyInLocal.length > 0) {
                        log(`💾 LocalStorage에만 있는 사용자 (${onlyInLocal.length}명):`, 'warning');
                        onlyInLocal.forEach(email => log(`  - ${email}`));
                    }

                    if (onlyInFirebase.length === 0 && onlyInLocal.length === 0) {
                        log('✅ Firebase와 LocalStorage가 완전히 동기화됨', 'success');
                    } else {
                        log('⚠️ Firebase와 LocalStorage 간 차이가 발견됨', 'warning');
                    }

                } else {
                    log('❌ Firebase가 준비되지 않음', 'error');
                }

            } catch (error) {
                log(`비교 중 오류: ${error.message}`, 'error');
            }
        }

        async function testCompleteRegisterLoginFlow() {
            log('🚀 완전한 회원가입→로그인 플로우 테스트 시작...');

            try {
                const testEmail = `test-flow-${Date.now()}@example.com`;
                const testPassword = 'test123';
                const testUser = {
                    name: '플로우 테스트',
                    email: testEmail,
                    password: testPassword,
                    phone: '010-1234-5678'
                };

                log(`테스트 사용자: ${testEmail} / ${testPassword}`);

                // LMS 인스턴스 생성 (실제 LMS와 동일한 로직)
                const mockLMS = {
                    users: JSON.parse(localStorage.getItem('lms_users') || '[]'),
                    isFirebaseReady: typeof firebaseService !== 'undefined' && firebaseService.isFirebaseReady,

                    async register(userData) {
                        log('📝 회원가입 시도...');
                        let registrationResult = { success: false, user: null, method: null };

                        // Firebase 회원가입 시도
                        if (this.isFirebaseReady && typeof firebaseService !== 'undefined') {
                            try {
                                const result = await firebaseService.signUp(userData.email, userData.password, userData);
                                if (result.success) {
                                    registrationResult = { ...result, method: 'Firebase' };
                                    log('✅ Firebase 회원가입 성공', 'success');

                                    // localStorage 동기화
                                    const currentUsers = JSON.parse(localStorage.getItem('lms_users') || '[]');
                                    const existsInLocal = currentUsers.find(u => u.email === userData.email);
                                    if (!existsInLocal) {
                                        const syncUser = {
                                            ...registrationResult.user,
                                            authMethod: 'firebase',
                                            registeredAt: new Date().toISOString()
                                        };
                                        currentUsers.push(syncUser);
                                        localStorage.setItem('lms_users', JSON.stringify(currentUsers));
                                        this.users = currentUsers;
                                        log('✅ localStorage 동기화 완료', 'success');
                                    }
                                } else {
                                    log(`❌ Firebase 회원가입 실패: ${result.error}`, 'error');
                                }
                            } catch (e) {
                                log(`Firebase 회원가입 오류: ${e.message}`, 'error');
                            }
                        }

                        // Firebase 실패 시 localStorage 폴백
                        if (!registrationResult.success) {
                            const existingUser = this.users.find(u => u.email === userData.email);
                            if (existingUser) {
                                return { success: false, error: '이미 존재하는 이메일입니다.' };
                            }

                            const newUser = {
                                id: Date.now(),
                                name: userData.name,
                                email: userData.email,
                                password: userData.password,
                                phone: userData.phone,
                                authMethod: 'localStorage',
                                registeredAt: new Date().toISOString()
                            };

                            this.users.push(newUser);
                            localStorage.setItem('lms_users', JSON.stringify(this.users));
                            registrationResult = { success: true, user: newUser, method: 'localStorage' };
                            log('✅ localStorage 회원가입 성공', 'success');
                        }

                        return registrationResult;
                    },

                    async login(email, password) {
                        log('🔑 로그인 시도...');
                        let loginResult = { success: false, user: null, method: null };

                        // Firebase 로그인 시도
                        if (this.isFirebaseReady && typeof firebaseService !== 'undefined') {
                            try {
                                const result = await firebaseService.signIn(email, password);
                                if (result.success) {
                                    loginResult = { ...result, method: 'Firebase' };
                                    log('✅ Firebase 로그인 성공', 'success');
                                } else {
                                    log(`❌ Firebase 로그인 실패: ${result.error}`, 'warning');
                                }
                            } catch (e) {
                                log(`Firebase 로그인 오류: ${e.message}`, 'warning');
                            }
                        }

                        // Firebase 실패 시 localStorage 폴백
                        if (!loginResult.success) {
                            const foundUser = this.users.find(u => u.email === email);
                            if (foundUser) {
                                if (foundUser.authMethod === 'firebase') {
                                    log('❌ Firebase 계정 - Firebase Authentication 필요', 'error');
                                } else if (foundUser.authMethod === 'localStorage' || !foundUser.authMethod) {
                                    if (foundUser.password === password) {
                                        loginResult = { success: true, user: foundUser, method: 'localStorage' };
                                        log('✅ localStorage 로그인 성공', 'success');
                                    } else {
                                        log('❌ 비밀번호 불일치', 'error');
                                    }
                                }
                            } else {
                                log('❌ 등록되지 않은 이메일', 'error');
                            }
                        }

                        return loginResult;
                    }
                };

                // 1단계: 회원가입
                log('1️⃣ 회원가입 단계');
                const registerResult = await mockLMS.register(testUser);

                if (!registerResult.success) {
                    log(`❌ 회원가입 실패: ${registerResult.error}`, 'error');
                    return;
                }

                log(`✅ 회원가입 성공 (${registerResult.method})`, 'success');

                // 2단계: 즉시 로그인 시도
                log('2️⃣ 로그인 단계');
                const loginResult = await mockLMS.login(testEmail, testPassword);

                if (loginResult.success) {
                    log(`🎉 로그인 성공 (${loginResult.method})!`, 'success');
                    log('✅ 회원가입→로그인 플로우 완전 성공!', 'success');

                    // 사용자 정보 확인
                    log('사용자 정보:');
                    log(`  이름: ${loginResult.user.name}`);
                    log(`  이메일: ${loginResult.user.email}`);
                    log(`  인증방식: ${loginResult.user.authMethod || loginResult.method}`);

                } else {
                    log('❌ 로그인 실패 - 회원가입 후 바로 로그인할 수 없음', 'error');
                    log('🔍 원인 분석 중...');

                    // 원인 분석
                    const savedUsers = JSON.parse(localStorage.getItem('lms_users') || '[]');
                    const savedUser = savedUsers.find(u => u.email === testEmail);

                    if (savedUser) {
                        log(`저장된 사용자 발견:`);
                        log(`  authMethod: ${savedUser.authMethod}`);
                        log(`  password: ${savedUser.password ? '있음' : '없음'}`);
                    } else {
                        log('저장된 사용자 없음', 'error');
                    }
                }

            } catch (error) {
                log(`플로우 테스트 오류: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>